<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard</title>
    <style>
      body {
        font-family: Arial;
        background: #111;
        color: #fff;
        padding: 2rem;
      }
      input,
      select,
      textarea,
      button {
        margin: 0.5rem 0;
        padding: 0.5rem;
        font-size: 1rem;
        width: 100%;
        border-radius: 5px;
        border: none;
      }
      button {
        cursor: pointer;
        background: gold;
        color: #111;
        font-weight: bold;
        transition: 0.2s;
      }
      button:hover {
        background: #ffd700cc;
      }
      .dashboard-card {
        background: #1a1a1a;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 1.5rem;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
      }
      .dashboard-card h2 {
        color: gold;
        margin-top: 0;
      }
      .table-wrapper {
        max-height: 280px;
        overflow-y: auto;
        border-radius: 10px;
        border: 1px solid rgba(255, 215, 0, 0.3);
      }
      .table-wrapper table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      .table-wrapper th,
      .table-wrapper td {
        padding: 8px 10px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .table-wrapper th {
        background: rgba(255, 215, 0, 0.1);
        color: gold;
        position: sticky;
        top: 0;
      }
      .table-wrapper tbody tr:nth-child(even) {
        background: rgba(255, 255, 255, 0.03);
      }
      .table-wrapper table button {
        padding: 4px 8px;
        font-size: 12px;
        border-radius: 4px;
        width: auto;
      }
      #logoutBtn {
        margin-bottom: 1rem;
      }
    </style>
  </head>
  <body>
    <h1>Admin Dashboard</h1>

    <button id="logoutBtn">Logout</button>

    <!-- Add Workout -->
    <div class="dashboard-card">
      <h2>Add Workout</h2>
      <label>Day:</label>
      <select id="day">
        <option>MONDAY</option>
        <option>TUESDAY</option>
        <option>WEDNESDAY</option>
        <option>THURSDAY</option>
        <option>FRIDAY</option>
        <option>SATURDAY</option>
        <option>SUNDAY</option>
      </select>
      <label>Workout Name:</label>
      <select id="name">
        <option>LOWER STRENGTH + EASY RUN</option>
        <option>UPPER STRENGTH + SKI INTERVALS</option>
        <option>ELEV8 RUN CLUB</option>
        <option>CONDITIONING / ROW FOCUS</option>
        <option>UPPER STRENGTH + HYROX SIMULATION</option>
        <option>HYROX SATURDAY</option>
        <option>LONG RUN + CORE</option>
      </select>
      <label>Time:</label>
      <select id="time">
        <option>6:00 am – 7:00 am (UK)</option>
        <option>6:00 pm – 7:00 pm (UK)</option>
        <option>7:30 am – 8:30 am (UK)</option>
      </select>
      <label>Encouragement:</label>
      <select id="encouragement">
        <option>YOU GOT THIS!</option>
        <option>KEEP IT UP!</option>
        <option>IT'S EASY!</option>
        <option>FEEL THE BURN!</option>
        <option>NO PAIN NO GAIN!</option>
        <option>CRUSH IT!</option>
        <option>LETS GO!</option>
      </select>
      <label>Details:</label>
      <textarea id="details" rows="3" placeholder="Optional details"></textarea>
      <button id="addBtn">Add Workout</button>
    </div>

    <!-- Workouts Table -->
    <div class="dashboard-card">
      <h2>Workouts</h2>
      <div class="table-wrapper">
        <table id="workoutTable">
          <thead>
            <tr>
              <th>Day</th>
              <th>Name</th>
              <th>Time</th>
              <th>Encouragement</th>
              <th>Details</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <!-- Users / Stats -->
    <div class="dashboard-card">
      <h2>Users / Stats</h2>
      <div class="table-wrapper">
        <table id="userLogsTable">
          <thead>
            <tr>
              <th>UID</th>
              <th>Email</th>
              <th>Total Workouts</th>
              <th>Status</th>
              <th>Current Workout</th>
              <th>Hours on App</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <script>
      const ADMIN_EMAIL = "Lewispotts0310@gmail.com"; // lowercase for safety
      const currentUser = JSON.parse(
        localStorage.getItem("currentUser") || "null"
      );

      // Check if admin
      if (!currentUser || currentUser.email.toLowerCase() !== ADMIN_EMAIL) {
        alert("Access denied.");
        window.location.href = "login.html";
      }

      // ---------- WORKOUTS ----------
      let workouts = JSON.parse(localStorage.getItem("workouts") || "[]");
      function renderWorkouts() {
        const tbody = document.querySelector("#workoutTable tbody");
        tbody.innerHTML = "";
        workouts.forEach((w, i) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${w.day}</td>
            <td>${w.name}</td>
            <td>${w.time}</td>
            <td>${w.encouragement}</td>
            <td>${w.details || "-"}</td>
            <td><button class="remove-workout-btn" data-index="${i}">Remove</button></td>
          `;
          tbody.appendChild(tr);
        });
      }
      function addWorkout() {
        const day = document.getElementById("day").value;
        const name = document.getElementById("name").value.trim();
        const time = document.getElementById("time").value.trim();
        const encouragement = document
          .getElementById("encouragement")
          .value.trim();
        const details = document.getElementById("details").value.trim();
        if (!day || !name || !time || !encouragement)
          return alert("Fill all fields!");
        workouts.push({
          day,
          name,
          time,
          encouragement,
          details: details || "-",
        });
        localStorage.setItem("workouts", JSON.stringify(workouts));
        renderWorkouts();
      }
      function removeWorkout(index) {
        workouts.splice(index, 1);
        localStorage.setItem("workouts", JSON.stringify(workouts));
        renderWorkouts();
      }
      document.getElementById("addBtn").addEventListener("click", addWorkout);
      document
        .querySelector("#workoutTable tbody")
        .addEventListener("click", (e) => {
          if (e.target.classList.contains("remove-workout-btn"))
            removeWorkout(parseInt(e.target.dataset.index));
        });

      // ---------- USERS / STATS ----------
      function getUsers() {
        return JSON.parse(localStorage.getItem("users") || "{}");
      }
      function getSessions() {
        return JSON.parse(localStorage.getItem("sessions") || "{}");
      }
      function saveSessions(sessions) {
        localStorage.setItem("sessions", JSON.stringify(sessions));
      }

      function renderUsers() {
        const users = getUsers();
        const sessions = getSessions();
        const tbody = document.querySelector("#userLogsTable tbody");
        tbody.innerHTML = "";

        Object.values(users).forEach((u) => {
          if (!u.email || u.email.toLowerCase().includes("test")) return;
          const status = Object.values(sessions).some(
            (s) => s.email === u.email
          )
            ? "✅ Online"
            : "❌ Offline";
          const totalWorkouts = u.totalWorkouts || 0;
          const currentWorkout = u.currentWorkout || "-";
          const totalMinutes = u.totalMinutes || 0;
          const hours = Math.floor(totalMinutes / 60);
          const minutes = totalMinutes % 60;

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${u.uid}</td>
            <td>${u.email}</td>
            <td>${totalWorkouts}</td>
            <td>${status}</td>
            <td>${currentWorkout}</td>
            <td>${hours}h ${minutes}m</td>
            <td><button class="remove-user-btn" data-email="${u.email}">Remove</button></td>
          `;
          tbody.appendChild(tr);
        });
      }

      document
        .querySelector("#userLogsTable tbody")
        .addEventListener("click", (e) => {
          if (!e.target.classList.contains("remove-user-btn")) return;
          const email = e.target.dataset.email;
          if (email.toLowerCase() === ADMIN_EMAIL)
            return alert("Cannot delete admin account!");
          if (!confirm(`Delete ${email}?`)) return;

          const users = getUsers();
          delete users[email];
          localStorage.setItem("users", JSON.stringify(users));

          const sessions = getSessions();
          Object.keys(sessions).forEach((id) => {
            if (sessions[id].email === email) delete sessions[id];
          });
          saveSessions(sessions);

          renderUsers();
        });

      // ---------- LOGOUT ----------
      document.getElementById("logoutBtn").addEventListener("click", () => {
        const sessionId = localStorage.getItem("sessionId");
        if (sessionId) {
          const sessions = getSessions();
          delete sessions[sessionId];
          saveSessions(sessions);
        }
        localStorage.removeItem("currentUser");
        alert("Logged out!");
        window.location.href = "login.html";
      });

      // Auto-refresh
      renderWorkouts();
      renderUsers();
      setInterval(() => {
        renderWorkouts();
        renderUsers();
      }, 2000);
    </script>
  </body>
</html>

